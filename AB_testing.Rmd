------------------------------------------------------------------------

------------------------------------------------------------------------

Подсчитаем результаты AB теста в R, проверим статистическую гипотезу алгоритмом bootstrap. Для этого загрузим наши данные и посмотрим на них.

```{r setup, include=FALSE}
data_ab_testing <- read.csv(file.choose())
data_ab_testing
```

Мы видим три колонки: X - индефикатор строки, OLD - кликнул/не кликнул пользователь на старом дизайне сайта на нужный его элемент. NEW - кликнул/не кликнул пользователь на новом дизайне сайта на нужный его элемент.

```{r}
#Всего пользователей
print(length(data_ab_testing$OLD) + length(data_ab_testing$NEW))
```

Сформулируем нулевую и направленную альтернативную правостороннюю гипотезу.

H0: Полученная конверсия на новом сайте не отличается от конверсии на старом сайте

H1: Полученная конверсия на старом сайте ниже полученной конверсии на новом сайте

Подсчитаем вероятности клика на исследуемый элемент дизайна сайта и результаты запишем в соответствующие переменные.

```{r}
A_test <- data_ab_testing$OLD
B_test <- data_ab_testing$NEW

p_old <- sum(A_test) / length(A_test)
p_new <- sum(B_test) / length(B_test)

print(p_new - p_old) #Разница между конверсиями на новом дизайне сайта и на старом
```

Создадим N = 1500 выборок из A_test и B_test с возвращением для подсчета новых разниц в вероятностей клика на старом и на новом сайте (по модулю).

```{r}
N = 1500 

differences <- rep(NA, N) #куда запишем значения разниц

for (i in 1:N){
  s1 <- sample(A_test, replace = TRUE)
  s2 <- sample(B_test, replace = TRUE)
  p1 <- sum(s1)/length(s1)
  p2 <- sum(s2)/length(s2)
  p_diff <- p2 - p1
  differences[i] <- p_diff
}

differences[1:10]
```

Посмотрим на распределение наших вероятностей

```{r}

hist(differences, 
     main="Распределение вероятностей", 
     xlab = "Вероятность",
     ylab = "Частота появления",
     col='ivory')

```

Найдем новую долю по всем выборкам, когда вероятность была выше 0.6325

```{r}
sum(differences >= 0.6325) / N
```

Определим уровень значимости в 5%, тогда

```{r}
sum(differences >= 0.6325) / N < 0.05
```

Следовательно мы не можем отвергнуть нулевую гипотезу, а значит она верна
